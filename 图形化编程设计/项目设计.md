## 数据类型

卡牌表示(卡牌组)
- 一张张卡牌
  - 卡牌需要兼顾有可扩展性
  - 卡牌id
  - 卡牌效果
    - **如何描述卡牌效果?**
      - 直接使用文字来描述(拒绝保留关键词)
    - 如何规定卡牌结算?
      - 事实上,特殊的结算使用传递框,而卡牌自己只是让**行动**亮起并且能够被填入传递框罢了
    - !图形化函数结算所有的卡牌
    - **可扩展卡牌**
      - 扩展卡牌的实质时扩展行动和扩展传递框!
      - 扩展卡牌的实质就是让无声响应序列能够有判断条件!

- 区域
    - 手牌区域
    - 银行区域
    - 牌库区域
    - 牌堆区域
    - **可扩展区域**


- ~~时机定义和扳机定义~~ 使用响应序列
  - 注册函数
  - 自定义事件?
  - 事件集
    - 回合开始
      - 结算注册函数
    - 回合中
      - ~~交换银行时~~
      - **打出某牌**
      - 卡牌转移
        - 卡牌进入区域
        - 卡牌离开区域(?)
      - ~~(玩家)执行(二白/)~~
      - **触发他人的特殊打出效果**
      - 见到某牌(?)
    - 回合结束
      - 抽牌
      - 摸到炸弹
      - 死亡/弃牌

    - 一轮
    - 整场游戏

- 传递框(菜篮子)(事实上是卡牌基础操作)
  - 元操作
    - 弃牌(直接到弃牌堆)
    - 使用(和弃牌名称不同)
    - 转移
    - 标记
    - 湮灭
    - 银行传递框
    - ?自定义元操作
  - 点击确认后依次触发递交,依次触发响应序列
  - 自定义无法被操作的新卡牌传递框 (这些传递框因为不是从手上获取牌二十创建牌,所以不触发响应事件)
  - 环回问题
    - 当传递的src和dst是同一区域
    - (可能无需考虑环回问题)

- 行动
  - 自定义行动
  - 在满足了行动的内置前提后可以执行行动
  - 点击行动会弹出来多个传递框
  - 在满足了传递框后可以递交
  - 递交后按照行动的要求依次选择被执行人
  - 被执行人选择完毕后弹出(确认/取消)
  - 确认后开始执行,开始响应事件列
  -
  - 行动中带ctn ctn为0后无法再行动 ctn为-1为无穷次行动
  - 将一部分行动放入(完成这些行动后才能且立即回合结束)

- 标记
  - 卡牌标记的原因时为了给卡牌分某种组
  - 打上卡牌标记的时间
    - 在使用传递框操作某区域时
    - ?自动给某一类卡牌打上标记(如回合结束时给最后出的一张卡牌打上标记)

## 问题研究

卡牌定义: 一张张定义
- 打出某二连卡牌视作打出一个\[卡牌1,卡牌2\]
  - 坏处
    - 可能会出现如index error的情况(**是否可以拒绝index??**)
    - 编程需要加数目索引和取值(图形化运算能力?)
  - 好处
    - 可以借此创建无限的卡牌组合

## 游戏流程

游戏开始
- 选择英雄/自定义英雄
- 摸牌(系统直接帮忙摸)(此处考虑:摸到炸弹后放回or直接无炸弹摸牌)
- 选出白板猫作为银行

其他人回合
- 其他人打出卡牌后,会轮询每个玩家是否要打出响应(类似于三国杀)
  - 无法响应的玩家也有回合结束计时条,但倾向于2s内结束掉
  - 响应可以嵌套子序列如
    >1打出功能牌 (1在此暗响应) 2跳过 3打出否决 
    >
    >以3打出的否决接着创建一次序列,(3暗响应) 4跳过(不否决3的否决) 1跳过 2跳过 子序列结束
    >
    >继续结算1创建功能牌的子序列 此时4依旧可以响应1的功能牌
  - 响应可以处理(小猫钓鱼)
  - 使回合结束也会创建一个响应序列(处理拾荒)
  - 响应序列可以处理帮助(其他玩家都跳过而某玩家不跳过)
  - 响应序列理应分为无声响应序列和显式响应序列
    - 无声响应序列处理(拾荒, 帮助)等等效果明确,不会因为无声而提供信息的序列, (特点是没有决策的空间, 倒计时结束后必须要选择一个交出)
    - **响应序列是否无声可以让玩家自定??**
    - 无论是有声还是无声响应序列都可以开启子响应序列
    - 例如帮助会开启响应序列1:玩家b失去某手牌,接着开启序列2:玩家a得到某手牌

自己回合
- 以其他人的\[回合结束\]作为自己回合开始的标志
- 出牌
  - 如何确定玩家将要进行的行动?(如出一白究竟是想要拆除掉一个人的陷阱或是一个人的钓饵?)**指定行动和指定区域**
  - 目标选择是在什么时候? (如何促进区域内的目标选择?)
    - 自定区域无法被选为目标,只能在出牌前点击"特殊动作"
    - 自定行动无法被匹配识别,只能先点击自定行动(然后在传递框内拖入符合要求的牌 系统对这个传递框进行检查)
    - 系统定义的卡牌组合(单走攻击等)区分为定向和非定向
    - 定向卡牌: 拖入传递框,此时:传递框.执行事件=0,检测传递框内的卡牌是否与某种预置模式相匹配,更改传递框的执行事件, 接着, 等待设置执行的目标(目标理应是区域,且非自定义区域)(可以多次设置目标), (确认or取消 设置的目标), 点击执行(传递框依次出发), 轮询结束, 传递框到达, 轮询结束, 效果触发, 

  - 自定义传递框
    - 如果要求是 出一张白+湮灭一张功能+和银行交换一张+给其他一个玩家一张牌 **此时传递框需要能够分为四个组件,并且四个组件要达到"一起匹配,一起出发"**
  
  - 自定义传递框匹配表达式
    - 被诅咒卡牌(拥有蓝色标记)(新申明标记,标记动态分配颜色,标记放在卡牌左侧)
    - 新增 <拥有(x)标记的卡牌> 的匹配

  - 区域互动效果
    - 如何判断是否应该能够看到卡牌?
    - 自摸(int)数量卡牌 **注意,在线上,暗牌自摸和随机给没有任何区别**
    - 在(area)区域中的 满足(class1 or class2)的所有卡牌中自摸
    - 如何处理抉择操作?(弃掉人家2张或者是自己摸走一张?)
      - 考虑用传递框表达操作
      >\[操作1\[弃牌\[卡牌1,卡牌2\]\]\]
      >
      >\[操作2\[获得(转移至自己手牌中)\[卡牌1\]\]\] 
      - 传递框表达式可以使用小箭头来切换操作

    - 如何处理多玩家操作?(选择一个玩家让他弃一张,另一位玩家弃两张)
      - 多玩家操作时, 操作名直接在指定操作区域时便加以区分(lor的7费慢速弹幕)
      - 对某个区域的执行

    - 如何给卡牌添加标记?(使一张卡牌变为被诅咒的卡牌!)
      -卡牌标记必须要能够覆盖掉原先的预置(被诅咒的卡牌或许就不能直接打出了)
      - 拖入一张卡牌到传递标记框内并打上标记
      - 标记中, 定义其所有者新增加的行动
      - 想要打出被诅咒的卡牌必须要能够献祭一张白卡怎么办?
        - 每个玩家都可以找到所有的已注册行动(别人给自己注册的也在内,甚至别人给别人自己注册的也在内 这便是整局游戏的全部行动)
        - 别人的行动在\[主控者非自己\]时被隐藏, 其他行动在不满足条件时被隐藏(可以点击查看全部行动,然后鼠标移上去看看需要满足哪些条件(可以直接看代码吗))
        - 而一旦手牌中出现了"诅咒"卡牌, 那么某条件被满足了, 对应的行动也被打开了

    - 如何给某玩家手上塞入新卡牌?(自定义自伤卡牌!)
      - 定义一个无法修改且已经预置了某新卡牌的传递框, 这个传递框传递的对象区域来源于行动的指定

    - **添加标记/添加卡牌 更要能够添加玩家可以进行的动作!**(因为是非预置卡牌)

- 与银行做交换
  - 交换时点击(交易行动(交易行动如何限制回合次数?:每个行动都要设置(无限次/有限次)))
  - 出现传递框
  - 拖入任意可以被放入传递框的卡牌(如何设置"不能放入银行传递框?")

- 回合结束摸牌
  - 回合结束必须要完成一些动作, 完成这些动作之后必然回合结束
  - 回合结束按钮 进入准备回合结束动作
    - 准备回合结束时不能使用回合结束框外的任何动作

- 令牌桶
  - 死亡时在令牌桶中删除玩家
  - 令牌桶:一般回合
    - 回合结束时, 把令牌桶\[0\]移除,然后在队尾加入自己
  - 令牌桶:被攻击回合
    - 回合结束时, 把令牌桶\[0\]移除
  - 令牌桶:插入行动
    - 回合结束, 回合结束轮询结束
    - 新回合, 行动回合, 行动回合轮询开始
    - 被轮询到的人执行行动并继续触发轮询
    - 行动如将aaa的手牌给bbb一张
    - **因此很可能需要在左上角标明令牌桶情况**

- 摸到炸弹猫
  - 进入摸到炸弹猫轮询
    - 轮询中, 自己的(拆解行动)亮起
    - 点击拆解行动后,出现传递框:
      >\[抽到炸弹\[炸弹(不可移动)\[炸弹1\]\]\] \[拆解\[拆解1\]\]\]
    - 放入拆解并递交后产生 拆解离开手牌+拆解进入弃牌堆 + 炸弹离开手牌+炸弹回到牌库 的响应序列
    - 拆解结束后,玩家继续回合结束
    - 编辑令牌桶
  - 轮询结束后无意外玩家死亡(death())
  - 死亡后一个死亡篮子弃掉所有手牌(甚至会包括弃牌时触发效果的卡牌)
  - 玩家离开令牌桶(令牌桶强制删除玩家)
  - 玩家的主动响应序列默认不触发(无动作)

- 摸到任意卡
  - 任意卡的摸到效果在轮询时触发
  - 因此自定义卡牌理应定义轮询

